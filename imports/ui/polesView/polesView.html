<template name='polesView'>
    
{{#contentFor "headerTitle"}}
      <h1 class="title">{{poleName}}</h1>
{{/contentFor}}
{{#contentFor "headerButtonLeft"}}
                   {{>ionNavBackButton}}
{{/contentFor}}
{{#contentFor "headerButtonRight"}}

  <button class="button button-clear icon ion-android-notifications brand-base-text-color pull-right all-seen" data-ion-menu-toggle="right">
   {{#transition in="bounceInDown" out="bounceOutUp"}}
   {{#if notificationsCount}}
   <div class="new-notification-bubble animated out">{{notificationsCount}}</div>
   {{/if}}
   {{/transition}}
  </button>
  {{/contentFor}}

  {{#ionView}}
    {{#ionContent class="scroll-bg"}}
    {{#if dataReady}}
    <div class="list">
        {{>organizationList}}
      {{#each project in poleProjects2}}
        {{>projectList2 project=project}}
      {{/each}} 
      </div>
      {{/if}}
    {{/ionContent}}
  {{/ionView}}
</template>

<template name="organizationList">
{{#if organizationActionsCount}}
<div class="item item-stable">Action de l'organisation <span class="badge badge-dark">{{organizationActions.count}}</span></div>
{{#each action in organizationActions}}
{{> itemInputAction action=action}}
{{/each}}
{{/if}}
</template>

<template name="projectList2">

{{#if projectGlobalCount project._id}}
  <div class="item item-stable item-avatar item-button-right">
    {{> imgDoc profilThumbImageUrl=project.profilThumbImageUrl}}

    <a href="{{pathFor 'actionsList' _id=project._id._str scope='projects'}}" class="dark">
        <h2 class="dark">{{project.name}}</h2>
    </a>

    {{#if scroll }}
      <button class="button button-dark button-see-event-js"> <i
          class="icon ion-ios-arrow-up"></i></button>

    {{else}}

      <button class="button button-dark button-see-event-js"> <i
          class="icon ion-ios-arrow-down"></i></button>

    {{/if}}
  </div>
{{/if}}

  {{#if scroll }}

  {{#if projectActionsCount project._id}}
  <div class="item item-stable">Action du projet <span class="badge badge-dark">{{projectActionsCount project._id}}</span></div>
  {{#each action in projectActions project._id}}
  {{> itemInputAction action=action}}
  {{/each}}
  {{/if}}

  {{#if projectEventsCount project._id}}
  <div class="item item-stable">Evenements du projet<span class="badge badge-dark">{{projectEventsCount project._id}}</span></div>
  {{#each event in projectEvents project._id}}
  {{>eventsList2 item=event}}
  {{/each}}
  {{/if}}

  {{/if}}


</template>

<template name="eventsList2">

  {{#with item}}
  <div class="item {{#if profilThumbImageUrl}}item-thumbnail-left{{/if}} item-button-right">
    {{#if profilThumbImageUrl}}
    <img src="{{urlImageCommunecter}}{{profilThumbImageUrl}}">
    {{/if}}
    <a href="{{pathFor 'actionsList' _id=_id._str scope=scopeVar}}" class="positive">
      <h2 class="positive">{{name}}</h2>
    </a>

    {{#if typeValue}}
    <p>{{typeValue}}</p>
    {{/if}}

    {{#if organizerEvent}}
    <p>Projet :
      {{#each organizerItem in organizerEvent}}
      {{#each organizerItemValue in organizerItem.values}}
      <a href="{{pathFor 'detailList' _id=organizerItemValue._id._str scope=organizerItem.type}}"
        class="positive">{{organizerItemValue.name}}</a>
      {{/each}}
      {{/each}}
    </p>
    {{/if}}


    {{#if startDate}}
    <p>
      {{#if isStart}}
      <i class="icon ion-android-alarm-clock"></i> {{__ "start"}} : {{livestamp startDate}} <br>
      {{#if endDate}}
      <i class="icon ion-android-alarm-clock"></i> {{__ "end"}} : {{livestamp endDate}} <br>
      <i class="icon ion-android-time"></i> {{__ "duration"}} : {{diffInText startDate endDate}}<br>
      {{/if}}
      {{else}}
      <i class="icon ion-android-alarm-clock"></i> {{__ "start"}} : {{livestamp startDate}} <br>
      {{#if endDate}}
      <i class="icon ion-android-time"></i> {{__ "duration"}} : {{diffInText startDate endDate}}<br>
      {{/if}}
      {{/if}}
    </p>
    {{/if}}

    {{#if eventActionCount _id._str}}

    {{#if scrollAction }}
      <button class="button button-small button-see-actions-js">Cacher {{actionsCount.todo}} actions <i
          class="icon ion-ios-arrow-up"></i></button>
    {{else}}
      <button class="button button-small button-see-actions-js">Voir {{actionsCount.todo}} actions <i
          class="icon ion-ios-arrow-down"></i></button>
    {{/if}}

    {{/if}}
  </div>

  {{/with}}

  {{#if scrollAction }}
  <div class="item item-stable">Action de l'evenement <span class="badge badge-dark">{{eventActionCount item._id._str}}</span></div>
  {{#each action in eventAction item._id._str}}

  {{> itemInputAction action=action}}

  {{/each}}
  {{/if}}

</template>

<template name="itemAction">

    {{> itemInputAction action=action}}

</template>

<template name="itemInputAction">
    <div class="item item-button-right">
        <h2><a href="{{pathFor 'actionsDetail' _id=action.parentId scope=action.parentType roomId=action.idParentRoom actionId=action._id._str}}"
            class="dark">{{action.name}}</a></h2>
        <p>{{> actionDate action=action}}</p>
            {{#if displayDesc}}
            <div class="button display-desc-js"> <i class="icon ion-ios-arrow-up"></i> </div>
            {{else}}
            <div class="button display-desc-js"> <i class="icon ion-ios-arrow-down"></i> </div>
            {{/if}}
    </div>
    {{#if displayDesc}}
    <div class="item">
        <div class="row row-center padding-bottom">
            {{> actionParticipantNeeded action=action}}
            {{> actionDuration action=action }}
        </div>
        <div div class="col ">
            {{#if action.creditPositive}}
            <div class="row">
                <div class="col-10"><i class="icon ion-card"> </i></div>
                <div class="col">Vous gagnerez {{action.credits}} crédits</div>
            </div>
            {{else}}
            <div class="row">
                <div class="col-10"><i class="icon ion-card"> </i></div>
                <div class="col">Vous serez prélevé de
                    {{action.creditNegative}} crédits</div>
            </div>
            {{/if}}
            <div class="row">
                <div class="col-10"> <i class="ion-android-calendar"></i></div>
                <div class="col">Début le
                    {{action.projectDay}}</div>
            </div>
            <div class="row">
                <div class="col-10"><i class="ion-clock"></i></div>
                <div class="col">Durée
                    {{action.projectDuration}} H</div>
            </div>
            <div class="row">
                <div class="col-10"><i class="ion-man"></i></div>
                <div class="col">Il y a {{action.actionParticipantsNbr}}
                    participant</div>
            </div>
            <div class="row row-wrap">
                <div class="col-10"> <i class="icon ion-ios-arrow-down"></i></div>
                <div class="col item-text-wrap ">Pour un besoin minimum de
                    {{action.min}} participant</div>
            </div>
            <div class="row">
                <div class="col-10"><i class="icon ion-ios-arrow-up"></i></div>
                <div class="col">Et un maximum de {{action.max}}
                    participant</div>
            </div>
        </div>
                <div class="row">
                    {{>buttonSubscribeAction action }}
                </div>
                </div>
        {{/if}}

</template>

<template name="itemInputActionDetail">
    <div class="item">
        <div class="row row-center padding-bottom">
            {{> actionParticipantNeeded action=action}}
            {{> actionDuration action=action }}
        </div>

        <div div class="col ">
                {{#if action.creditPositive}}
                <div class="row">
                    <div class="col-10"><i class="icon ion-card"> </i></div>
                    <div class="col">Vous gagnerez {{action.credits}} crédits</div>
                </div>
                {{else}}
                <div class="row">
                    <div class="col-10"><i class="icon ion-card"> </i></div>
                    <div class="col">Vous serez prélevé de
                    {{action.creditNegative}} crédits</div>
                </div>
                {{/if}}
                <div class="row">
                    <div class="col-10"> <i class="ion-android-calendar"></i></div>
                    <div class="col">Début le
                    {{action.projectDay}}</div>
                </div>
                <div class="row">
                    <div class="col-10"><i class="ion-clock"></i></div>
                    <div class="col">Durée
                    {{action.projectDuration}} H</div>
                </div>
                <div class="row">
                    <div class="col-10"><i class="ion-man"></i></div>
                    <div class="col">Il y a {{action.actionParticipantsNbr}}
                    participant</div>
                </div>
                <div class="row row-wrap">
                    <div class="col-10"> <i class="icon ion-ios-arrow-down"></i></div>
                    <div class="col item-text-wrap ">Pour un besoin minimum de
                    {{action.min}} participant</div>
                </div>
                <div class="row">
                    <div class="col-10"><i class="icon ion-ios-arrow-up"></i></div>
                    <div class="col">Et un maximum de {{action.max}}
                    participant</div>
                </div>
        </div>
    </div>
    {{>buttonSubscribeAction action }}
    
</template>

<template name="buttonSubscribeAction">

{{#if isContributors}}
<div class="item col col-center text-center">
    {{#if isEndDate}}
    <span class="assertive"><i class="fa fa-hourglass-end"></i> Terminé</span>
    {{else}}
    {{#if isStartDate}}
    <span class="energized"><i class="fa fa-clock-o"></i> {{__ "dda.actions.youparticipatingaction"}}</span> <br> fin <strong>{{timeSpentEnd}}</strong>
    {{else}}
    <span class="balanced"><i class="fa fa-check"></i> {{__ "dda.actions.youparticipatingaction"}}</span> <br> commence <strong>{{timeSpentStart}}</strong>
    {{/if}}
    {{/if}}
</div>
{{else}}
{{#if isAFaire}}
{{#if isEndDate}}
<div class="item col col-center text-center">
    <span class="assertive"><i class="fa fa-hourglass-end"></i> Terminé</span>
</div>
{{else}}
{{#if isStartDate}}
<div class="item col col-center text-center">
    <span class="energized"><i class="fa fa-clock-o"></i> En cours</span> <br> fin <strong>{{timeSpentEnd}}</strong>
</div>
{{else}}
{{#if isNotMax}}
<div class="button-bar bar-positive padding-top">
    <button class="button action-assignme-js {{#if isCall}}disabled{{/if}}">
        {{#if isCall}}
        <i class="icon fa fa-refresh fa-spin"></i>
        {{else}}
        <i class="fa fa-handshake-o"></i>
        {{/if}}
        {{__ "dda.actions.wantparticipateaction"}}</button>
</div>
{{else}}
<div class="item col col-center text-center">
    <span class="balanced"><i class="fa fa-check"></i> Déja complet</span>
</div>
{{/if}}
{{/if}}
{{/if}}

{{else}}
{{#if isDepense}}
{{#if isNotMax}}
<div class="button-bar bar-balanced padding-top">
    <button class="button action-depenseme-js {{#if isCall}}disabled{{/if}}">
        {{#if isCall}}
        <i class="icon fa fa-refresh fa-spin"></i>
        {{else}}
        <i class="ion-card"></i>
        {{/if}}
        Dépenser {{credits}}</button>
</div>
{{else}}
<div class="item col col-center text-center">
    <span class="balanced"><i class="fa fa-check"></i> Déja complet</span>
</div>
{{/if}}
{{/if}}

{{/if}}
{{/if}}
</template>

<template name="actionDuration">
    <div class="col text-center col-center borderMenuItem stable-border"><i class="ion-clock"></i>
        {{action.projectDuration}}H </div>
    <div class="col text-center col-center borderMenuItem stable-border"><i class="icon ion-card"></i>
        {{action.credits}}
        {{#if settingOceco.account}}
        {{#if settingOceco.account.textUnite}}{{settingOceco.account.textUnite}}{{else}}R{{/if}}
        {{else}}
        R
        {{/if}}</div>
</template>

<template name="actionParticipantNeeded">
    <div class="col text-center col-center borderMenuItem stable-border"><i class="icon ion-man"></i>
        {{action.actionParticipantsNbr}}</div>
    <div class="col text-center col-center borderMenuItem stable-border"><i class="icon ion-ios-arrow-down"></i>
        {{action.min}}</div>
    <div class="col text-center col-center borderMenuItem stable-border"><i class="icon ion-ios-arrow-up"></i>
        {{action.max}}</div>
</template>

<template name="actionDate">
    <span><i class="ion-android-calendar"></i>{{action.projectDayHour}}</span>
</template>

<template name="linkForAction">
    <b><a
            href="{{pathFor 'actionsDetail' _id=action.parentId scope=action.parentType roomId=action.idParentRoom actionId=action._id._str}}">{{action.name}}</a>
    </b> <br>
</template>


